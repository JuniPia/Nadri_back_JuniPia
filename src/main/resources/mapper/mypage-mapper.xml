<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.iei.member.model.dao.MypageDao">

	<select id="reviewsList" resultType="review">
    select * from
		(select rownum as rnum, r.*from
		(select 
		review_no,
		review_title,
		review_content,
		star_rate,
		member_nickname,
		review_date
		from review 
	<where>
		<choose>
			<when test="value == 'plan'">
				content_type = #{value}
			</when>
			<when test="value == 'spot'">
				 place_type_id = 12
			</when>
			<when test="value == 'food'">
				 place_type_id = 39
			</when>
			<when test="value == 'room'">
				 place_type_id = 32
			</when>
			<when test="value == 'todo'">
				place_type_id IN (14, 15, 38, 28)
			</when>
		 </choose>
	 </where>
	 order by review_no desc)r)
	 where member_nickname = #{nickname}
  </select>

	<select id="BookmarkList" resultType="Place">
		  SELECT * FROM (
		    SELECT rownum AS rnum, c.* FROM (
		      SELECT 
		      	p.place_id,
		        p.place_thumb,
		        p.area_code,
		        a.area_name,
		        p.sigungu_code,
		        s.sigungu_name,
		        p.place_title,
		        p.place_cat3,
		        cat.cat3_name
		      FROM place_info p
		      LEFT JOIN area_code a ON p.area_code = a.area_code
		      LEFT JOIN sigungu_code s 
		        ON p.sigungu_code = s.sigungu_code 
		       AND p.area_code = s.area_code
		      LEFT JOIN place_cat3 cat ON p.place_cat3 = cat.cat3
		      
		   		<where>
				  <if test="placeCat != 0">
				    <choose>
				      <when test="value == 'spot'">
				        AND p.place_type_id = 12
				      </when>
				      <when test="value == 'todo'">
				        AND p.place_type_id IN (14, 15, 28, 38)
				      </when>
				      <when test="value == 'room'">
				        AND p.place_type_id = 32
				      </when>
				      <when test="value == 'food'">
				        AND p.place_type_id = 39
				      </when>
				    </choose>
				  </if>
				</where>
		      
		      ORDER BY p.place_title ASC
		    ) c
		  )
		  WHERE rnum BETWEEN 1 AND 10
	</select>

	<select id="plannerList" resultType="plan">
		select * from trip_plan
		<where>
			<choose>
				<when test="value == 1">
					 end_date >= TRUNC(CURRENT_DATE)
				</when>
				<when test="value == 2">
					 end_date &lt; TRUNC(CURRENT_DATE)
				</when>
			 </choose>
	 	</where>
	</select>
</mapper>
