<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.iei.place.model.dao.PlaceDao">
	
	<select id="totalCount">
		select count(*) from place_info
		<where>
			  <if test="placeTypeId != 0">
			    <choose>
			      <when test="placeTypeId == 12">
			        place_type_id =12
			      </when>
			      <when test="placeTypeId == 14">
			        place_type_id IN (14, 15, 28, 38)
			      </when>
			      <when test="placeTypeId == 32">
			        place_type_id =32
			      </when>
			      <when test="placeTypeId == 39">
			        place_type_id =39
			      </when>
			    </choose>
			  </if>
			</where>
	</select> 
	

	<select id="selectPlaceList" resultType="Place">
	  SELECT * FROM (
	    SELECT rownum AS rnum, c.* FROM (
	      SELECT 
	      	p.place_id,
	        p.place_thumb,
	        p.area_code,
	        a.area_name,
	        p.sigungu_code,
	        s.sigungu_name,
	        p.place_title,
	        p.place_cat3,
	        cat.cat3_name
	      FROM place_info p
	      LEFT JOIN area_code a ON p.area_code = a.area_code
	      LEFT JOIN sigungu_code s 
	        ON p.sigungu_code = s.sigungu_code 
	       AND p.area_code = s.area_code
	      LEFT JOIN place_cat3 cat ON p.place_cat3 = cat.cat3
	      
	   		<where>
			  <if test="placeTypeId != 0">
			    <choose>
			      <when test="placeTypeId == 12">
			        AND p.place_type_id = 12
			      </when>
			      <when test="placeTypeId == 14">
			        AND p.place_type_id IN (14, 15, 28, 38)
			      </when>
			      <when test="placeTypeId == 32">
			        AND p.place_type_id = 32
			      </when>
			      <when test="placeTypeId == 39">
			        AND p.place_type_id = 39
			      </when>
			    </choose>
			  </if>
			</where>
	      
	      ORDER BY p.place_title ASC
	    ) c
	  )
	  WHERE rnum BETWEEN #{pi.start} AND #{pi.end}
	</select>
	
	
	<!-- place 타입 테이블 조회 -->
	<select id="selectPlaceType" resultType="map">
	    select place_type_id as "id", place_type_name as "name"
    	from place_type
	</select>
	
	
<!-- place 조회 -->
	<select id="selectOnePlace" resultType="place">
		SELECT
		    c2.cat2_name,
		    c3.cat3_name,
		    p.place_title,
		    a.area_name,
		    s.sigungu_name,
		    p.place_overview,
		    p.place_addr,
		    p.place_tel,
		    place_thumb,
		    place_type_id
		FROM place_info p
			LEFT JOIN place_cat2 c2 ON p.place_cat2 = c2.cat2
			LEFT JOIN place_cat3 c3 ON p.place_cat3 = c3.cat3
			LEFT JOIN area_code a ON p.area_code = a.area_code
			LEFT JOIN sigungu_code s ON p.sigungu_code = s.sigungu_code AND p.area_code = s.area_code
		WHERE p.place_id = #{placeId}
	</select>

	 
	 <!--  초기 데이터: place데이터 -->
	<insert id="insertPlaceInfoList" parameterType="java.util.List">
	    INSERT INTO place_info (
	        place_id, place_type_id, place_title, place_addr, place_tel,
	        area_code, sigungu_code,
	        place_cat1, place_cat2, place_cat3,
	        map_lat, map_lng, place_thumb
	    )
	    <foreach collection="list" item="place" separator="union all">
	        SELECT
	        #{place.placeId}, #{place.placeTypeId}, #{place.placeTitle}, #{place.placeAddr}, #{place.placeTel},
	        #{place.areaCode}, #{place.sigunguCode},
	        #{place.placeCat1}, #{place.placeCat2}, #{place.placeCat3},
	        #{place.mapLat}, #{place.mapLng}, #{place.placeThumb}
	        FROM DUAL
	    </foreach>
	</insert>
		 
	  
</mapper>
